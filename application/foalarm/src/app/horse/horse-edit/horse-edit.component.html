<div class="card primaryCard">
  <div class="card-header">
    Horses | Edit
    <span class="pull-right">
      <a class="btn btn-social-icon" [routerLink]="['/profile/horse-list']">
        <i class="fa fa-window-close" aria-hidden="true"></i>
      </a>
    </span>
  </div>
</div>

<ng-container *ngIf="(authService.user | async) || {} as user">
  <ng-container *ngIf="horse$ | async as horse">
    <div class="card primaryCard" style="padding-top: 0 !important; margin-top: 0">

      <div *ngIf="!isNewHorse" class="card-body card-img-bg" [style]="getStyle(horse.photoURL)">
        <a class="btn btn-social-icon pull-right">
          <span [ngClass]="horse.state ? 'active' : 'inactive'">
            <i class="fa fa-circle" aria-hidden="true"></i>
          </span>
        </a>
      </div>

      <div class="card-body">
        <!-- If user is registered -->
        <form [formGroup]="horseForm" (ngSubmit)="save(user, horse, horse.alarmId)">
          <div class="form-row">
            <div class="form-group input-group-sm col-md-8">
              <small>Horse Name</small>
              <input type="text" class="form-control" formControlName="displayName" [(ngModel)]="horse.displayName" [value]="">
            </div>
            <div class="form-group input-group-sm col-md-4">
              <small>Due Date</small>
              <input type="text" class="form-control" formControlName="dueDate" [(ngModel)]="horse.dueDate" [value]="">
            </div>
            <div class="form-group input-group-sm col-md-6">
              <small>Current Foalarm</small>
              <input type="text" class="form-control" [value]="horse.alarmId" disabled>
            </div>
            <div class="form-group input-group-sm col-md-6">
              <small>Foalarm</small>
              <app-alarm-select (messageEvent)="receiveSelectedOption($event)"></app-alarm-select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group input-group-sm col-md-12">
              <small>Foaling Camera Url</small>
              <input type="text" class="form-control" formControlName="camera" [(ngModel)]="horse.camera" [value]="">
            </div>
            <div class="form-group input-group-sm col-md-12">
              <small>Horse Image</small>
              <input class="form-control" type="file" (change)="uploadFile(horse, $event)" formControlName="photoURL">
              <div *ngIf="!loaded && loading">
                <div class="progress">
                  <div class="progress-bar progress-bar-striped progress-bar-animated bg-info" role="progressbar" aria-valuenow="75" aria-valuemin="0"
                    aria-valuemax="100" style="width: 75%"></div>
                </div>
              </div><br>
              <div *ngIf="loaded && loading" class="alert alert-info">
                Image uploaded successfully
              </div>
            </div>
          </div>
          <button *ngIf="!isNewHorse" type="button" class="btn btn-secondary btn-sm pull-right" (click)="delete(horse)">
            <i class="fa fa-trash-o fa-lg"></i>
          </button>
          <button type="submit" class="btn btn-success btn-sm" [disabled]="!horseForm.valid || (loaded===false)">
              <i class="fa fa-sign-in" aria-hidden="true"></i> Save
            </button>
        </form>
      </div>
    </div>
  </ng-container>
</ng-container>